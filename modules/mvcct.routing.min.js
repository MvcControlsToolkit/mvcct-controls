(function(){(function(A){var f=this||(0,eval)("this");(function(q){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?q(module.exports||exports):"function"===typeof define&&define.amd?define(["exports"],q):q(f.mvcct.routing={})})(function(q){function B(b){var d=this._router_infos_;if(!d)return!0;b=b||f.event;var k=b.target||b.srcElement,p=k.getAttribute("href"),p=(k=k.getAttribute("data-action"))||p;return!p||k||!d.fakeUrls&&0==p.indexOf(d.baseUrl+"#")?(p&&d.router.history.set(p),
b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0,!1):!0}function x(b){return decodeURIComponent((b||"").replace(/\+/g," "))}function r(b,d){for(var k in obj)"undefined"===typeof b[k]&&(b[k]=d[k])}function v(b,d,k,f,c){k=k||{};var l=[],h,a=null,e=null,g=null,m=r({},k);this.children=null;b&&(y.lastIndex=0,h=b.replace(y,function(a,g,b,k){l.push({name:b,optional:"?"==k,g:"/"==g});m.hasOwnProperty(b)&&delete m[b];return"?"==k?"/"==g?"(?:/([^/]+))?":
"([^/]*)":"/"==g?"/([^/]+)":"([^/]+)"}),h=new RegExp(h+(d?"":"$")));this.f=function(a){return a.replace(z,"")};this.match=function(a,b){var u;h.lastIndex=0;g=r({},k);if(null!==(u=h.exec(this.f(a)))){b=r(b||{},k);for(var e=1;e<u.length;e++)l[e-1]&&l[e-1].name&&u[e]&&(g[l[e-1].name]=x(u[e]));var e=g,n={},c,m,f;if((c=a.match(z))&&c[1])for(c=c[1].split("&"),f=0;f<c.length;f++){m=c[f].split("=");var d=x(m[0]);m=x(m[1]||"");"undefined"!==typeof n[d]?_isArray(n[d])?n[d].push(m):n[d]=[n[d],m]:n[d]=m}g=r(e,
n);r(b,g);return u[0].length}return!1};this.action=function(a,g){for(var e=0;e<l.length;e++){var c=l[e];if(c&&c.name&&!c.optional&&!a[c.name])return!1}for(var d in m)if(m.hasOwnProperty(d)&&m[d]!=a[d])return!1;for(var f=r(r({},k),a),e=0;e<l.length;e++)(c=l[e])&&c.name&&a.hasOwnProperty(c.name)&&delete a[c.name];for(d in m)a.hasOwnProperty(d)&&delete a[d];e=0;return(g||"")+b.replace(y,function(a,g,b){a=l[e];e++;var c=b?f[b]||"":"";return!b||a.optional&&c==k[a.name]?"":c?(g||"")+c:""})};this.b=function(g,
d,m,l){if(g===A)return!1;g=g||"";var n=0;c?(d=r(d,k),n=g.length):b&&(n=this.match(g,d,l));if(!1===n)return!1;var h="";0<n&&(h=g.substr(0,n),g=g.substr(n));m=m&&(!b&&!c||h===a);f&&!m&&f(d,l,this.children);a=h;if(this.children){for(n=0;n<this.children.length;n++)if(h=this.children[n],h.b(g,d,m&&e==h,l+1))return e=h,!0;return!1}return!0};this.c=function(a){if(b){var c;a:{for(c in g)if(g.hasOwnProperty(c)&&a.hasOwnProperty(c)){c=!1;break a}r(a,g);c=!0}if(!c||!d||!e)return}else if(!d||!e)return;e.c(a)};
this.a=function(a,g){var c=g;b&&(c=this.action(a,g));if(!1===c)return!1;if(this.children){for(var e=c,d=0;d<this.children.length;d++)if(!1!==(e=this.children[d].a(a,c)))return e;return!1}return c}}function C(b){var d="";this.back=function(c){f.history.back(c)};this.forward=function(c){f.history.forward(c)};this.go=function(c){f.history.go(c)};this.refresh=function(){b(f.location.hash||"#")};this.set=function(c,b){c&&c.length&&"#"==c.charAt(0)?b?f.location.replace((""+f.location).split("#")[0]+c):
f.location.hash=c:b?f.location.assign(c):f.location.replace(c)};if(b){var k=function(){b(f.location.hash||"#")};if("onhashchange"in f&&(!document.documentMode||8<=document.documentMode))f.addEventListener?(f.addEventListener("hashchange",k,!1),this.reset=function(){f.removeEventListener("hashchange",k)}):(attachEvent("onhashchange",k),this.reset=function(){f.detachEvent("onhashchange",k)});else{var p=setInterval(function(){var c=f.location.hash||"#";c!=d&&(d=c,b(f.location.hash||"#"))},50);this.reset=
function(){clearInterval(p)}}}}function D(b,d,k){function p(a){a.canBack=0<h.length;a.canForward=0<l.length}function c(a){b&&(k||(a=a.split("#"),2>a.length?a="#":a="#"+a[1]),b(a))}d=d||"";var l=[],h=[];this.title=this.url="";this.canBack=this.canForward=!1;this.clear=function(a,b){if(a){var g=a&&a.length&&"#"==a.charAt(0)?(d||(""+f.location).split("#")[0])+a:a;c(g);a=g}this.url=a||"";this.title=b||"";l=[];h=[];p(this)};this.set=function(a,b,g){a=a&&a.length&&"#"==a.charAt(0)?(d||(""+f.location).split("#")[0])+
a:a;b||(l=[],h.push({url:this.url,title:this.title}));this.url=a;this.title=g;c(a);p(this)};this.forward=function(a){a=a||1;a>l.length&&(a=l.length);if(!(0>=a)){a=r(l.splice(-a,a));if(1==a.length)h.push({url:this.url,title:this.title}),this.url=a[0].url,this.title=a[0].title;else{a.reverse();var b=a.pop(),g=h;g.push({url:this.url,title:this.title});this.url=b.url;this.title=b.title;h=g.concat(a)}c(this.url);p(this)}};this.back=function(a){a=a||1;a>h.length&&(a=h.length);if(!(0>=a)){a=r(h.splice(-a,
a));if(1==a.length)l.push({url:this.url,title:this.title}),this.url=a[0].url,this.title=a[0].title;else{a.reverse();var b=a.pop(),g=l;g.push({url:this.url,title:this.title});this.url=b.url;this.title=b.title;l(g.concat(a))}c(this.url);p(this)}}}"undefined"===typeof q&&(q={});var y=/(\/?):([\w\d]+)(\??)/g,z=/\?([^#]*)?$/,E=encodeURIComponent;this.go=function(b){0<b?this.forward(b):0>b&&this.back(-b)};var t=null,w=null;q.reset=function(){t&&(t.history.reset(),t=null)};q.router=function(b,d,f,p){function c(a){h.b(a,
{},!0,-1);p&&p(this)}var l=!1,h=new v(null,!0),a=[],e=h;!b&&t&&(b=!0);d=d||"";this.history=b?new D(c,d,f):new C(c);b||(t=this,q.history=t.history,f=!1);this.attach=function(a){if(b){var c=a._router_infos_;c||""===c||a.addEventListener("click",B,!1);a._router_infos_={baseUrl:d,fakeUrls:f,router:this}}};this.detach=function(a){b&&a._router_infos_&&(a._router_infos_="")};this.prefix=function(b,c,d){d=d||w;e.children||(e.children=[]);b=new v(b,!0,c,d);e.children.push(b);a.push(e);e=b;return this};this.end=
function(){a.length&&(e=a.pop());return this};this.route=function(a,b,c){c=c||w;e.children||(e.children=[]);e.children.push(new v(a,!1,b,c));return this};this.notFound=function(a,b){b=b||w;e.children||(e.children=[]);e.children.push(new v(null,!1,a,b,!0));return this};this.action=function(a){res={};for(var b in a)a.hasOwnProperty(b)&&(res[b]=a[b]);a=res;(b=a._rel)&&delete a._rel;(l||b)&&h.c(a);b=d+h.a(a,"");var c="",e;for(e in a)if(a.hasOwnProperty(e)){var f=a[e];f&&(f=E(f),c=c?c+("&"+e+"="+f):"?"+
e+"="+f,c[e]=a[e])}return b+c};this.defaultParameters=function(a){l=a}};q.action=function(b){return t?t.action(b):!1};q.defaultAction=function(b){w=b}})})()})();
