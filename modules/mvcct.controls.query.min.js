(function(){(function(u){var l=this||(0,eval)("this");(function(f){if("function"===typeof define&&define.amd)define(["../mvcct.controls","./mvcct.controls.ajax","../../mvcct-enhancer/mvcct.enhancer.min","../../mvcct-odata/dest/umd/mvcct.odata.min"],f);else if("object"===typeof exports&&"object"===typeof module)module.exports=f(require("../mvcct.controls"),require("./mvcct.controls.ajax"),require("mvcct-enhancer"),require("mvcct-odata/dest/umd/mvcct.odata.min"));else{var m=l.mvcct=l.mvcct||{};f(m.controls,
m.controls,m.enhancer,m.odata)}})(function(f,m,p,k){function h(a,d){var b=a.args,c={},e;a:{for(e=a.control;e&&e.getAttribute;e=e.parentNode)if("FORM"==e.tagName)break a;e=null}c.form=e;1<b.a&&(c.url=b[1]);2<b.a&&(c.ajaxId=b[2]);e=document.getElementById(b[0]+"_"+d+"_window");document.getElementById(b[0]+"_"+d).query_expando=c;q(e)}function r(a,d){return a&&a.length&&a.length!=d?new k.QueryFilterBooleanOperator(k.QueryFilterBooleanOperator.and,a[d],r(a,d+1)):null}function v(a){fieldsIndex={};[].filter.call(a.elements,
function(a){return"radio"!=a.type&&"button"!=a.type&&"reset"!=a.type&&"submit"!=a.type&&"BUTTON"!=a.tagName||a.checked}).filter(function(a){return!!a.name}).filter(function(a){return!a.disabled}).forEach(function(a){var c=!1,b=a.name,e=a.value.trim();if(e){0<=b.indexOf(".Operator",b.length-9)&&(c=!0,b=b.substr(0,b.length-9));var d=fieldsIndex[b];d||(d={},fieldsIndex[b]=d);if(c)"inv-contains"==e?(d.operator="contains",d.inv=!0):(d.operator=e,d.inv=!1);else if(d.property=b.substr(b.indexOf(".")+1),
c=a.getAttribute("type"),b=a.getAttribute("data-original-type")||c,"datetime-local"==b&&(b="datetime"),d.jsType=b,"checkbox"==b?d.jsValue=a.checked:(d.jsValue=p.parse(b,e,"hidden"==c||"radio"==c||"SELECT"==a.tagName),d.jsUtc="true"==a.getAttribute("data-is-utc"),d.jsValue||"hidden"!=c||(d.property=null)),e=a._companion_display_)d.takeFrom=e.name;else if((att=a.getAttribute("data-operation"))&&0==att.indexOf("autocomplete")){for(e=a.nextSibling;e&&1!=e.nodeType;e=e.nextSibling);e&&(d.takeFrom=e.name)}}});
var d=a.querySelectorAll("[data-name]");if(d)for(var b=0;b<d.length;b++){var c=d[b];a=c.getAttribute("data-name");a=a.substr(0,a.length-9);(c=c.getAttribute("data-value"))&&a&&(a=fieldsIndex[a])&&("inv-contains"==c?(a.operator="contains",a.inv=!0):(a.operator=c,a.inv=!1))}var d=[],e;for(e in fieldsIndex)if(fieldsIndex.hasOwnProperty(e)){a=fieldsIndex[e];if(c=a.takeFrom)c=fieldsIndex[c],a.operator=c.operator,a.inv=c.inv,c.property||"eq"!=a.operator||(a.operator="startswith");if(((c=a.jsValue)||0===
c)&&a.property&&a.operator)switch(b=new k.QueryFilterCondition(a),d.push(b),a.jsType){case "date":case "month":case "week":b.setDate(c);break;case "number":case "range":b.setNumber(c);break;case "time":b.setTime(c);break;case "checkbox":b.setBoolean(c);break;case "datetime":a.jsUtc?b.setDateTimeInvariant(c):b.setDateTimeLocal(c);break;default:b.setString(c)}}return r(d,0)}function w(a){fieldsIndex={};[].filter.call(a.elements,function(a){return"radio"!=a.type&&"checkbox"!=a.type&&"button"!=a.type&&
"reset"!=a.type&&"submit"!=a.type&&"BUTTON"!=a.tagName||a.checked}).filter(function(a){return!!a.name}).filter(function(a){return!a.disabled}).forEach(function(a){if(a.value.trim()){var b=null,d=!1;0==a.name.indexOf("sorting_")?b=a.name.substr(8):(d=!0,b=a.name.substr(13));var f=fieldsIndex[b];f||(fieldsIndex[b]=f={});d?f.down="desc"==a.value:f.property=a.value}});a=[];for(var d in fieldsIndex)if(fieldsIndex.hasOwnProperty(d)){var b=fieldsIndex[d];b.property&&a.push(new k.QuerySortingCondition(b))}return a.length?
a:null}function x(a){var d=new k.QueryGrouping;[].filter.call(a.elements,function(a){return"radio"!=a.type&&"checkbox"!=a.type&&"button"!=a.type&&"reset"!=a.type&&"submit"!=a.type&&"BUTTON"!=a.tagName||a.checked}).filter(function(a){return!!a.name}).filter(function(a){return!a.disabled}).forEach(function(a){a.value.trim()&&("groupby"==a.value?(d.keys.push(a.name),(a=a.getAttribute("data-display-name"))&&d.keys.push(a)):d.aggregations.push(new k.QueryAggregation(a.value,a.name,"countdistinct"==a.value?
a.getAttribute("data-count-distinct"):a.name)))});return 0<d.keys.length?d:null}function n(a,d){var b=a.control,c=a.args[0];if(f.validateForm(b)){var e=b.query_expando||{},g=e.form,h=u;g?h=g.elements.namedItem(c):h=document.getElementsByName(c)[0];c=h;(g=c.query_expando)?c=g:(g=(g=c.value)?new k.QueryDescription(JSON.parse(g)):new k.QueryDescription,c=c.query_expando=g);"filter"==d?c.filter=v(b):"sorting"==d?c.sorting=w(b):c.grouping=x(b);c.take=0;c.skip=null;b=e.url;e=e.ajaxId;g=c.attachedTo||{};
b=b||g.baseUrl;e=e||g.ajaxId;b=c.addToUrl(b);e?(e=e.split(" "),f.attachHtml({href:b,args:e})):l.location.href=b}}function t(a){a=a.args;a.length&&(1==a.length?l.location.href=a[0]:"#"==a[1]?l.open(a[0]):f.attachHtml({href:a[0],args:2==a.length?[a[1]]:[a[1],a[2]]}))}var q;p.register(null,null,function(a){options=a.ajax=a.ajax||{};q=((a.serverWidgets||{}).modal||{}).openStaticModal},"ajax",null);f.addOperation("query-filtering_click",function(a){h(a,"filter")},"server-immediate-grid");f.addOperation("query-filtering_click",
function(a){h(a,"filter")},"server-batch-grid");f.addOperation("query-sorting_click",function(a){h(a,"sorting")},"server-immediate-grid");f.addOperation("query-sorting_click",function(a){h(a,"sorting")},"server-batch-grid");f.addOperation("query-grouping_click",function(a){h(a,"grouping")},"server-immediate-grid");f.addOperation("query-grouping_click",function(a){h(a,"grouping")},"server-batch-grid");f.addOperation("group-detail_click",function(a){t(a)},"server-immediate-grid");f.addOperation("group-detail_click",
function(a){t(a)},"server-batch-grid");f.addOperation("filter-window-submit_click",function(a){n(a,"filter")},"server-query-filter");f.addOperation("sort-window-submit_click",function(a){n(a,"sorting")},"server-query-sorting");f.addOperation("grouping-window-submit_click",function(a){n(a,"grouping")},"server-query-grouping");return f})})()})();
