(function(){(function(z){var m=this||(0,eval)("this");(function(g){if("function"===typeof define&&define.amd)define(["../mvcct.controls","./mvcct.controls.ajax","../../mvcct-enhancer/mvcct.enhancer.min","../../mvcct-odata/dest/umd/mvcct.odata.min"],g);else if("object"===typeof exports&&"object"===typeof module)module.exports=g(require("../mvcct.controls"),require("./mvcct.controls.ajax"),require("mvcct-enhancer"),require("mvcct-odata/dest/umd/mvcct.odata.min"));else{var h=m.mvcct=m.mvcct||{};g(h.controls,
h.controls,h.enhancer,h.odata)}})(function(g,h,t,k){function u(a){for(;a&&a.getAttribute;a=a.parentNode)if("FORM"==a.tagName)return a;return null}function n(a,b){var d=a.args,c={};c.form=u(a.target);1<d.a&&(c.url=d[1]);2<d.a&&(c.ajaxId=d[2]);var e=document.getElementById(d[0]+"_"+b+"_window");document.getElementById(d[0]+"_"+b).query_expando=c;v(e)}function w(a){var b=a.query_expando;if(b)return b;b=(b=a.value)?new k.QueryDescription(JSON.parse(b)):new k.QueryDescription;return a.query_expando=b}
function p(a,b,d){var c=a.attachedTo||{};b=b||c.baseUrl;b=a.addToUrl(b);d?(d=d.split(" "),g.attachHtml({href:b,args:d})):m.location.href=b}function x(a,b){return a&&a.length&&a.length!=b?new k.QueryFilterBooleanOperator(k.QueryFilterBooleanOperator.and,a[b],x(a,b+1)):null}function A(a){var b={};[].filter.call(a.elements,function(a){return"radio"!=a.type&&"button"!=a.type&&"reset"!=a.type&&"submit"!=a.type&&"BUTTON"!=a.tagName||a.checked}).filter(function(a){return!!a.name}).filter(function(a){return!a.disabled}).forEach(function(a){var d=
!1,c=a.name,e=a.value.trim();if(e){0<=c.indexOf(".Operator",c.length-9)&&(d=!0,c=c.substr(0,c.length-9));var f=b[c];f||(f={},b[c]=f);if(d)"inv-contains"==e?(f.operator="contains",f.inv=!0):(f.operator=e,f.inv=!1);else if(f.property=c.substr(c.indexOf(".")+1),d=a.getAttribute("type"),c=a.getAttribute("data-original-type")||d,"datetime-local"==c&&(c="datetime"),f.jsType=c,"checkbox"==c?f.jsValue=a.checked:(f.jsValue=t.parse(c,e,"hidden"==d||"radio"==d||"SELECT"==a.tagName),f.jsUtc="true"==a.getAttribute("data-is-utc"),
f.jsValue||"hidden"!=d||(f.property=null)),e=a._companion_display_)f.takeFrom=e.name;else if((att=a.getAttribute("data-operation"))&&0==att.indexOf("autocomplete")){for(e=a.nextSibling;e&&1!=e.nodeType;e=e.nextSibling);e&&(f.takeFrom=e.name)}}});var d=a.querySelectorAll("[data-name]");if(d)for(var c=0;c<d.length;c++){var e=d[c];a=e.getAttribute("data-name");a=a.substr(0,a.length-9);(e=e.getAttribute("data-value"))&&a&&(a=b[a])&&("inv-contains"==e?(a.operator="contains",a.inv=!0):(a.operator=e,a.inv=
!1))}var d=[],f;for(f in b)if(b.hasOwnProperty(f)){a=b[f];if(e=a.takeFrom)e=b[e],a.operator=e.operator,a.inv=e.inv,e.property||"eq"!=a.operator||(a.operator="startswith");if(((e=a.jsValue)||0===e)&&a.property&&a.operator)switch(c=new k.QueryFilterCondition(a),d.push(c),a.jsType){case "date":case "month":case "week":c.setDate(e);break;case "number":case "range":c.setNumber(e);break;case "time":c.setTime(e);break;case "checkbox":c.setBoolean(e);break;case "datetime":a.jsUtc?c.setDateTimeInvariant(e):
c.setDateTimeLocal(e);break;default:c.setString(e)}}return x(d,0)}function B(a){var b=[];[].filter.call(a.elements,function(a){return"radio"!=a.type&&"checkbox"!=a.type&&"button"!=a.type&&"reset"!=a.type&&"submit"!=a.type&&"BUTTON"!=a.tagName||a.checked}).filter(function(a){return!!a.name}).filter(function(a){return!a.disabled}).forEach(function(a){if(a.value.trim()){var d=null,c=!1;0==a.name.indexOf("sorting_")?d=a.name.substr(8):(c=!0,d=a.name.substr(13));var d=parseInt(d),e=b[d];e||(b[d]=e={});
c?e.down="desc"==a.value:e.property=a.value}});a=[];for(var d={},c=0;c<b.length;c++){var e=b[c];e&&(e.property&&!d[e.property]&&a.push(new k.QuerySortingCondition(e)),d[e.property]=!0)}return a.length?a:null}function C(a){var b=new k.QueryGrouping;[].filter.call(a.elements,function(a){return"radio"!=a.type&&"checkbox"!=a.type&&"button"!=a.type&&"reset"!=a.type&&"submit"!=a.type&&"BUTTON"!=a.tagName||a.checked}).filter(function(a){return!!a.name}).filter(function(a){return!a.disabled}).forEach(function(a){a.value.trim()&&
("groupby"==a.value?(b.keys.push(a.name),(a=a.getAttribute("data-display-name"))&&b.keys.push(a)):b.aggregations.push(new k.QueryAggregation(a.value,a.name,"countdistinct"==a.value?a.getAttribute("data-count-distinct"):a.name)))});return 0<b.keys.length?b:null}function q(a,b){var d=a.control,c=a.args[0];if(g.validateForm(d)){var e=d.query_expando||{},f=e.form,m=z;f?m=f.elements.namedItem(c):m=document.getElementsByName(c)[0];var l=w(m),c=l.attachedTo||{},h=e.ajaxId||c.ajaxId,c=null;if(h){c=document.getElementById(h.split(" ")[0]);
if(!c)return;c=c.stack_expando=c.stack_expando||{stack:[]};c.stack.push(new k.QueryDescription(l));c.curr=l;c.stack.length>r&&c.stack.shift()}"filter"==b?l.filter=A(d):"sorting"==b?l.sorting=B(d):l.grouping=C(d);l.take=0;l.skip=null;(d=document.getElementById(d.id+"_window"))?(d.expando_onHidden=function(){p(l,e.url,h)},y(d)):p(l,e.url,h)}}var v,y,r;t.register(null,null,function(a){var b=a.ajax=a.ajax||{},b=(a.serverWidgets||{}).modal||{};v=b.openStaticModal;y=b.closeStaticModal;b=a.query=a.query||
{};r=b.maxStack=b.maxStack||10},"ajax",null);g.addOperation("query-filtering_click",function(a){n(a,"filter")});g.addOperation("query-sorting_click",function(a){n(a,"sorting")});g.addOperation("query-grouping_click",function(a){n(a,"grouping")});g.addOperation("query-back_click",function(a){var b=a.args;a=u(a.target);var d,c;1<b.a&&(c=c[2]);2<b.a&&(d=b[2]);var e;a?e=a.elements.namedItem(b[0]):e=document.getElementsByName(b[0])[0];b=w(e);b=b.attachedTo||{};if(d=d||b.ajaxId)if(b=document.getElementById(d.split(" ")[0]))b=
b.stack_expando=b.stack_expando||{stack:[]},b.stack.length&&(b=b.curr=e.query_expando=b.stack.pop(),p(b,c,d))});g.addOperation("group-detail_click",function(a){a=a.args;if(a.length)if(1==a.length)m.location.href=a[0];else if("#"==a[1])m.open(a[0]);else{var b=2==a.length?[a[1]]:[a[1],a[2]],d=document.getElementById(b[0]);if(d){stack=d.stack_expando=d.stack_expando||{stack:[]};if(d=stack.curr)stack.stack.push(new k.QueryDescription(d)),stack.stack.length>r&&stack.stack.shift();g.attachHtml({href:a[0],
args:b})}}});g.addOperation("filter-window-submit_click",function(a){q(a,"filter")},"server-query-filter");g.addOperation("sort-window-submit_click",function(a){q(a,"sorting")},"server-query-sorting");g.addOperation("grouping-window-submit_click",function(a){q(a,"grouping")},"server-query-grouping");return g})})()})();
