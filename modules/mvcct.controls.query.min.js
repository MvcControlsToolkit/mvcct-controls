(function(){(function(u){var l=this||(0,eval)("this");(function(g){if("function"===typeof define&&define.amd)define(["../mvcct.controls","./mvcct.controls.ajax","../../mvcct-enhancer/mvcct.enhancer.min","../../mvcct-odata/dest/umd/mvcct.odata.min"],g);else if("object"===typeof exports&&"object"===typeof module)module.exports=g(require("../mvcct.controls"),require("./mvcct.controls.ajax"),require("mvcct-enhancer"),require("mvcct-odata/dest/umd/mvcct.odata.min"));else{var m=l.mvcct=l.mvcct||{};g(m.controls,
m.controls,m.enhancer,m.odata)}})(function(g,m,p,k){function h(a,f){var d=a.args,c={},b;a:{for(b=a.control;b&&b.getAttribute;b=b.parentNode)if("FORM"==b.tagName)break a;b=null}c.form=b;1<d.a&&(c.url=d[1]);2<d.a&&(c.ajaxId=d[2]);b=document.getElementById(d[0]+"_"+f+"_window");document.getElementById(d[0]+"_"+f).query_expando=c;q(b)}function r(a,f){return a&&a.length&&a.length!=f?new k.QueryFilterBooleanOperator(k.QueryFilterBooleanOperator.and,a[f],r(a,f+1)):null}function v(a){var f={};[].filter.call(a.elements,
function(a){return"radio"!=a.type&&"button"!=a.type&&"reset"!=a.type&&"submit"!=a.type&&"BUTTON"!=a.tagName||a.checked}).filter(function(a){return!!a.name}).filter(function(a){return!a.disabled}).forEach(function(a){var d=!1,b=a.name,c=a.value.trim();if(c){0<=b.indexOf(".Operator",b.length-9)&&(d=!0,b=b.substr(0,b.length-9));var e=f[b];e||(e={},f[b]=e);if(d)"inv-contains"==c?(e.operator="contains",e.inv=!0):(e.operator=c,e.inv=!1);else if(e.property=b.substr(b.indexOf(".")+1),d=a.getAttribute("type"),
b=a.getAttribute("data-original-type")||d,"datetime-local"==b&&(b="datetime"),e.jsType=b,"checkbox"==b?e.jsValue=a.checked:(e.jsValue=p.parse(b,c,"hidden"==d||"radio"==d||"SELECT"==a.tagName),e.jsUtc="true"==a.getAttribute("data-is-utc"),e.jsValue||"hidden"!=d||(e.property=null)),c=a._companion_display_)e.takeFrom=c.name;else if((att=a.getAttribute("data-operation"))&&0==att.indexOf("autocomplete")){for(c=a.nextSibling;c&&1!=c.nodeType;c=c.nextSibling);c&&(e.takeFrom=c.name)}}});var d=a.querySelectorAll("[data-name]");
if(d)for(var c=0;c<d.length;c++){var b=d[c];a=b.getAttribute("data-name");a=a.substr(0,a.length-9);(b=b.getAttribute("data-value"))&&a&&(a=f[a])&&("inv-contains"==b?(a.operator="contains",a.inv=!0):(a.operator=b,a.inv=!1))}var d=[],e;for(e in f)if(f.hasOwnProperty(e)){a=f[e];if(b=a.takeFrom)b=f[b],a.operator=b.operator,a.inv=b.inv,b.property||"eq"!=a.operator||(a.operator="startswith");if(((b=a.jsValue)||0===b)&&a.property&&a.operator)switch(c=new k.QueryFilterCondition(a),d.push(c),a.jsType){case "date":case "month":case "week":c.setDate(b);
break;case "number":case "range":c.setNumber(b);break;case "time":c.setTime(b);break;case "checkbox":c.setBoolean(b);break;case "datetime":a.jsUtc?c.setDateTimeInvariant(b):c.setDateTimeLocal(b);break;default:c.setString(b)}}return r(d,0)}function w(a){var f=[];[].filter.call(a.elements,function(a){return"radio"!=a.type&&"checkbox"!=a.type&&"button"!=a.type&&"reset"!=a.type&&"submit"!=a.type&&"BUTTON"!=a.tagName||a.checked}).filter(function(a){return!!a.name}).filter(function(a){return!a.disabled}).forEach(function(a){if(a.value.trim()){var b=
null,d=!1;0==a.name.indexOf("sorting_")?b=a.name.substr(8):(d=!0,b=a.name.substr(13));var b=parseInt(b),c=f[b];c||(f[b]=c={});d?c.down="desc"==a.value:c.property=a.value}});a=[];for(var d={},c=0;c<f.length;c++){var b=f[c];b&&(b.property&&!d[b.property]&&a.push(new k.QuerySortingCondition(b)),d[b.property]=!0)}return a.length?a:null}function x(a){var f=new k.QueryGrouping;[].filter.call(a.elements,function(a){return"radio"!=a.type&&"checkbox"!=a.type&&"button"!=a.type&&"reset"!=a.type&&"submit"!=a.type&&
"BUTTON"!=a.tagName||a.checked}).filter(function(a){return!!a.name}).filter(function(a){return!a.disabled}).forEach(function(a){a.value.trim()&&("groupby"==a.value?(f.keys.push(a.name),(a=a.getAttribute("data-display-name"))&&f.keys.push(a)):f.aggregations.push(new k.QueryAggregation(a.value,a.name,"countdistinct"==a.value?a.getAttribute("data-count-distinct"):a.name)))});return 0<f.keys.length?f:null}function n(a,f){var d=a.control,c=a.args[0];if(g.validateForm(d)){var b=d.query_expando||{},e=b.form,
h=u;e?h=e.elements.namedItem(c):h=document.getElementsByName(c)[0];c=h;(e=c.query_expando)?c=e:(e=(e=c.value)?new k.QueryDescription(JSON.parse(e)):new k.QueryDescription,c=c.query_expando=e);"filter"==f?c.filter=v(d):"sorting"==f?c.sorting=w(d):c.grouping=x(d);c.take=0;c.skip=null;d=b.url;b=b.ajaxId;e=c.attachedTo||{};d=d||e.baseUrl;b=b||e.ajaxId;d=c.addToUrl(d);b?(b=b.split(" "),g.attachHtml({href:d,args:b})):l.location.href=d}}function t(a){a=a.args;a.length&&(1==a.length?l.location.href=a[0]:
"#"==a[1]?l.open(a[0]):g.attachHtml({href:a[0],args:2==a.length?[a[1]]:[a[1],a[2]]}))}var q;p.register(null,null,function(a){options=a.ajax=a.ajax||{};q=((a.serverWidgets||{}).modal||{}).openStaticModal},"ajax",null);g.addOperation("query-filtering_click",function(a){h(a,"filter")},"server-immediate-grid");g.addOperation("query-filtering_click",function(a){h(a,"filter")},"server-batch-grid");g.addOperation("query-sorting_click",function(a){h(a,"sorting")},"server-immediate-grid");g.addOperation("query-sorting_click",
function(a){h(a,"sorting")},"server-batch-grid");g.addOperation("query-grouping_click",function(a){h(a,"grouping")},"server-immediate-grid");g.addOperation("query-grouping_click",function(a){h(a,"grouping")},"server-batch-grid");g.addOperation("group-detail_click",function(a){t(a)},"server-immediate-grid");g.addOperation("group-detail_click",function(a){t(a)},"server-batch-grid");g.addOperation("filter-window-submit_click",function(a){n(a,"filter")},"server-query-filter");g.addOperation("sort-window-submit_click",
function(a){n(a,"sorting")},"server-query-sorting");g.addOperation("grouping-window-submit_click",function(a){n(a,"grouping")},"server-query-grouping");return g})})()})();
